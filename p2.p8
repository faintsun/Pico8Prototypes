pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
phase1 = true
pause = false
phase2 = false

kick_lvl = 2
last_pressed = 1

timer = 0
timer_int = 50
dif = 1
dif_color = 3
jump_height = 0

wait_time = rnd(100) + 100

player = {}
player.x = 56
player.y = 98
player.width = 16
player.sprite = 12
player.speed = 1
player.yacc = 5
player.jumping = false

ball = {}
ball.x = rnd(96) + 16
ball.y = 108
ball.width = 8
ball.sprite = 16
ball.speed = 4

-----------------------
-- update  functions --
-----------------------

function _update()
 if timer >= wait_time then
 --if btn(3) then
 	change_phase()
 end
 
	if phase1 == true then
 	timer += 1
 	inc_crowd()
 	dec_crowd()
 	change_dif()
 	control_player()
 	
 elseif pause == true then
 	timer += 1
 	if timer >= 4 then
 		phase2 = true
 		pause = false
 	end
	
 elseif phase2 == true then
 	control_player()
 	update_ball()
 	
 elseif phase_lose == true then
 	
	end
end

-- phase 1

-- increase crowd level
function inc_crowd()
	if kick_lvl < 128 then
 	if btnp(4) and last_pressed == 0 then
 		
 		if dif < 3 then
 			kick_lvl += 2
 		elseif dif >= 3 then 
 			kick_lvl += 1
 		end
 			
 		last_pressed = 1
 	elseif btnp(5) and last_pressed == 1 then
 		kick_lvl += 1
 		last_pressed = 0
 	end
 end
end

-- decrease crowd level
function dec_crowd()
	if timer % timer_int == 0 and timer > 2 then
		kick_lvl -= 1
	end
end

-- change difficulty
function change_dif()

	if kick_lvl > 0 and kick_lvl <= 25 then
		timer_int = 50
		dif = 1
		dif_color = 3
	elseif kick_lvl > 25 and kick_lvl <= 50 then
		timer_int = 35
		dif = 2
		dif_color = 11
	elseif kick_lvl > 50 and kick_lvl <= 75 then
		timer_int = 25
		dif = 3
		dif_color = 10
	elseif kick_lvl > 75 and kick_lvl <= 100 then
		timer_int = 20
		dif = 4
		dif_color = 9
	elseif kick_lvl > 100 and kick_lvl <= 125 then
		timer_int = 15
		dif = 5
		dif_color = 8
	end
end

-- inbetween
function change_phase()
	phase1 = false
 pause = true
 timer = 0
 
 if dif == 1 then
 	player.speed = 0.5
 	ball.speed = 5
 	jump_height = 4
 	
 elseif dif == 2 then
 	player.speed = 1
 	ball.speed = 4
 	jump_height = 6
		
 elseif dif == 3 then
 	player.speed = 2
 	ball.speed = 4
 	jump_height = 7
 	
 elseif dif == 4 then
 	player.speed = 2
 	ball.speed = 2
 	jump_height = 8
 	
 elseif dif == 5 then
 	player.speed = 3
 	ball.speed = 1
 	jump_height = 9
 	
 end
end

-- phase 2

function control_player()

	if player.y >= 98 then
		player.yacc = 0
		player.y = 98
		player.jumping = false
	end
	
	if btn(0) and player.x > 0 then
		player.x -= player.speed
	elseif btn(1) and player.x + player.width + 1 < 128 then
		player.x += player.speed
	end
	if btn(2) and player.jumping == false then
		player.jumping = true
		player.yacc = -jump_height
	end
	
	
	player.y += player.yacc
	player.yacc += 0.5
	
	
end

function update_ball()
	ball.y -= ball.speed
	if ball.speed > 1 then
		ball.speed -= 0.1
	end
	
	-- collide with goal
	if ball.y <= 20 then
		phase_lose = true
		phase2 = false
	end
	
	-- collide with player
	if ball.x <= player.x + player.width and ball.x + ball.width >= player.x and ball.y <= player.y + player.width and ball.y + ball.width >= player.y then
		phase_win = true
		phase2 = false
	end
end


	 

-----------------------
-- drawing functions --
-----------------------

function _draw()
	cls()

	mapdraw(0, 0, 0, 0, 16, 16)
	draw_kickbar(kick_lvl, dif_color)

	draw_player()
	
	if pause == true then
		draw_ball()
	elseif phase2 == true then
		draw_ball()
	elseif phase_lose == true then
		draw_ball()
		print("not blocked", 45,5,7) 
	elseif phase_win == true then
		draw_ball()
		print("blocked!", 50,5,7)
	end
end

function draw_kickbar(w, d)
	rectfill(0, 121, 0 + w, 126, d)
end

function draw_player()
	spr(player.sprite, player.x, player.y, 2, 2)
end

function draw_ball()
	spr(ball.sprite, ball.x, ball.y)
	end
__gfx__
000000009aa911119aa911111111111111119aa911119aa911111144441111111111119aa9111111111111117777777700000007770000003333333333333333
000000009aa911119aa911111111111111119aa911119aa911111199a91111111111119aa9111111111111117777777700000cc777cc00003333333333333333
007007009aa911119aa911111111111111119aa911119aa91111119a991111111111119aa911111111111111777777770000ccc777ccc0003333333333333333
000770009aa911119aa911111111111111119aa911119aa911111199a91111111111119aa91111111111111177777777000cccc777cccc003333333333333333
000770009aa911119aaa9999999999999999aaa911119aa91111119a991111111111119aa91111111111111177777777000c111111111c003333333333333333
007007009aa911119aaaaaaaaaaaaaaaaaaaaaa911119aa91111119aa91111111111119aa91111111111111177777777000c888181888c003333333333333333
000000009aa9111199aaaaaaaaaaaaaaaaaaaa9911119aa91111119aa91111111111119aa91111111111111177777777000cfff1f1fffc003333333333333333
000000009aa9111119999999999999999999999111119aa91111119aa91111111111119aa91111111111111177777777000c5fffffff5c003333333333333333
00004444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000116555555561103333333333333333
04444744000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c16666666661c13333333333333333
0444744400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ccccccccccccccc3333333333333333
4447444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ccc1cc7c7cc1ccc3333333333333333
4474444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fff1cc7c7cc1fff3333333333333333
4744444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111ccccccccc1113333333333333333
44444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111110003333333333333333
44444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001700000710003333333333333333
__map__
0a010a0a0a0a0a0a0a0a0a0a0a0a050a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a010a0a0a0a0a0a0a0a0a0a0a0a050a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a010a0a0a0a0a0a0a0a0a0a0a0a050a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a02030303030303030303030303040a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a06070a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a0a0a0a0a0a08090a0a0a0a0a0a0a0a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
